<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DOe – Dosha Oscillating Engine</title>

<!-- MANIFEST (data URL) -->
<link rel="manifest" href="data:application/manifest+json,{
  'name':'DOe',
  'short_name':'DOe',
  'start_url':'./',
  'display':'standalone',
  'background_color':'#000000',
  'theme_color':'#00e0a8',
  'icons':[{
      'src':'https://cdn-icons-png.flaticon.com/512/4649/4649084.png',
      'sizes':'512x512',
      'type':'image/png'
  }]
}">

<style>
/* ===== Modern UI (Glassmorphic, mobile-first) ===== */
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #0a0a0a, #1a1a1a);
    color: #fff;
    padding: 20px;
}

.container {
    max-width: 420px;
    margin: auto;
}

.card {
    background: rgba(255,255,255,0.08);
    padding: 20px;
    border-radius: 20px;
    backdrop-filter: blur(15px);
    box-shadow: 0 0 20px rgba(0,255,180,0.15);
    margin-bottom: 20px;
}

h1 {
    text-align: center;
    font-size: 28px;
    margin-bottom: 8px;
    color: #00e0a8;
}

.subtitle {
    text-align: center;
    margin-bottom: 20px;
    opacity: 0.7;
}

label {
    font-size: 14px;
    opacity: 0.8;
}

input[type=range] {
    width: 100%;
}

.output-box {
    margin-top: 20px;
    padding: 15px;
    border-radius: 12px;
    background: rgba(0,255,180,0.08);
    text-align: center;
    font-size: 20px;
    color: #00ffbe;
}

.install-btn {
    margin-top: 20px;
    width: 100%;
    padding: 12px;
    border-radius: 10px;
    border: 0;
    background: #00e0a8;
    color: #000;
    font-size: 16px;
    cursor: pointer;
    display: none;
}
</style>
</head>

<body>

<div class="container">

    <h1>DOe Engine</h1>
    <div class="subtitle">Dosha Oscillating Engine</div>

    <div class="card">
        <label>Sleep Quality</label>
        <input type="range" id="sleep" min="0" max="100" value="50">

        <label>Stress Level</label>
        <input type="range" id="stress" min="0" max="100" value="50">

        <label>Digestion Strength</label>
        <input type="range" id="digestion" min="0" max="100" value="50">
    </div>

    <div class="output-box" id="result">
        Adjust sliders…
    </div>

    <button id="installBtn" class="install-btn">Install DOe App</button>

</div>

<script>
/* ===== DOe Logic ===== */
function calcDosha() {
    let s = +sleep.value;
    let st = +stress.value;
    let d = +digestion.value;

    let vata = (st * 0.6) + (s * 0.2);
    let pitta = (d * 0.7) + (st * 0.3);
    let kapha = (s * 0.8) - (st * 0.2);

    let maxDosha = Math.max(vata, pitta, kapha);
    let result = maxDosha === vata ? "VATA ↑"
              : maxDosha === pitta ? "PITTA ↑"
              : "KAPHA ↑";

    document.getElementById("result").innerText = result;
}

sleep.oninput = stress.oninput = digestion.oninput = calcDosha;


/* ===== SINGLE-FILE SERVICE WORKER via BLOB ===== */
const swCode = `
self.addEventListener('install', e => {
  self.skipWaiting();
});

self.addEventListener('activate', e => {
  clients.claim();
});

self.addEventListener('fetch', e => {
  e.respondWith(fetch(e.request));
});
`;

const blob = new Blob([swCode], { type: "text/javascript" });
const swURL = URL.createObjectURL(blob);

navigator.serviceWorker.register(swURL);


/* ===== Install Button Logic ===== */
let deferredPrompt;
const installBtn = document.getElementById("installBtn");

window.addEventListener("beforeinstallprompt", (e) => {
    e.preventDefault();
    deferredPrompt = e;
    installBtn.style.display = "block";
});

installBtn.addEventListener("click", async () => {
    if (!deferredPrompt) return;
    deferredPrompt.prompt();
    deferredPrompt = null;
    installBtn.style.display = "none";
});
</script>

</body>
</html>
